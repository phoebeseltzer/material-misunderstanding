<script>
  const years = Array.from({length:2025-1900+1}, (_,i)=>1900+i);
  const production=[], cumulative=[], waste=[], degraded=[];
  let total=0;
  for(let i=0;i<years.length;i++){
    const y=years[i];
    let prod=0;
    if(y<1950){ prod=Math.max(0.1*(y-1907),0); }
    else { prod=2*Math.pow(1.07,y-1950); }
    production.push(+prod.toFixed(1));
    total+=prod/1000;
    cumulative.push(+total.toFixed(2));
    const w=(i>=3)?production[i-3]*0.85:0;
    waste.push(+w.toFixed(1));
    degraded.push(y===2025?+(total*0.09).toFixed(2):0);
  }

  const ctx=document.getElementById('degradation-chart').getContext('2d');
  const chart=new Chart(ctx,{
    type:'line',
    data:{ labels:years, datasets:[
      { label:'Annual Production (Mt)', data:production, borderColor:'#00f0ff', yAxisID: 'y1', tension:0.25 },
      { label:'Cumulative Production (Bt)', data:cumulative, borderColor:'#00ff88', yAxisID: 'y2', tension:0.25 },
      { label:'Estimated Degraded (Bt)', data:degraded, borderColor:'#ff568f', yAxisID: 'y2', tension:0.25 }
    ]},
    options:{ responsive:true, interaction:{ intersect:false, mode:'index' },
      scales:{ 
        y1: { type: 'linear', position: 'left', beginAtZero:true, title:{ display:true, text:'Annual (Mt)' }, ticks:{ color:'#ccc' } },
        y2: { type: 'linear', position: 'right', beginAtZero:true, title:{ display:true, text:'Cumulative (Bt)' }, grid: { drawOnChartArea: false }, ticks:{ color:'#ccc' } },
        x:{ ticks:{ color:'#ccc' } }
      },
      plugins:{ legend:{ labels:{ color:'#e6e6e6' } } }
    }
  });

  document.getElementById('yearSlider').addEventListener('input',(e)=>{
    const year=+e.target.value;
    const i=years.indexOf(year);
    const prod=production[i];
    const w=waste[i];
    const cum=cumulative[i];
    const deg=degraded[i];
    const percentDeg = cum > 0 ? ((deg / cum) * 100).toFixed(1) : 0;
    document.getElementById('plastic-count').innerText=prod.toFixed(0);
    document.getElementById('waste-count').innerText=Math.round(w);
    document.getElementById('bar-plastic').style.width=(prod/500)*100+'%';
    document.getElementById('bar-waste').style.width=(w/500)*100+'%';
    document.getElementById('year-caption').innerHTML=`In <b>${year}</b>, plastic production was <b>${prod.toFixed(0)} Mt</b>, with <b>${Math.round(w)} Mt</b> waste. Cumulative total: <b>${cum.toFixed(2)} Bt</b>. <br>Estimated degraded: <b>${deg.toFixed(2)} Bt</b> (<b>${percentDeg}%</b>)`;
    chart.setActiveElements([{datasetIndex:0,index:i},{datasetIndex:1,index:i},{datasetIndex:2,index:i}]);
    chart.update();
  });
</script>
